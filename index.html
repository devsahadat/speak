<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Fluency Sprint 30 — WordPress YouTuber</title>
  <meta name="description" content="30-day speaking fluency sprint for a WordPress developer YouTuber: daily tongue twisters, vocabulary, phrase packs, drills."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ------- CSS Reset (light) ------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif; line-height: 1.55; letter-spacing: 0.2px; }
    img, svg, video { display: block; max-width: 100%; }

    :root {
      /* Dark Mode - Based on HSL = 245-35-7 to 245-55-50 */
      --bg: hsl(245, 35%, 7%);        /* Darkest BG - HSL = 245-35-7 */
      --bg2: hsl(245, 25%, 14%);      /* Darker BG - HSL = 245-25-14 */
      --glass: rgba(255,255,255,0.08);
      --card: rgba(255,255,255,0.10);
      --stroke: rgba(255,255,255,0.18);
      --text: hsl(0, 0%, 90%);      /* Strongest Text - HSL = 245-4-97 */
      --text-strong: hsl(0, 0%, 90%); /* Strong text - HSL = 245-7-95 */
      --text-medium: hsl(0, 0%, 90%); /* Medium Text - HSL = 245-10-90 */
      --muted: hsl(245, 10%, 49%);    /* Subtle Text/Border - HSL = 245-10-49 */
      --subtle-bg: hsl(245, 15%, 21%); /* Subtle BG - HSL = 245-15-21 */
      --brand: hsl(245, 55%, 50%);    /* Accent - HSL = 245-55-50 */
      --brand-alt: hsl(245, 45%, 40%); /* Accent Alt - HSL = 245-45-40 */
      --accent: #25d0ff;             /* cyan */
      --ok: #21d17c;                 /* green */
      --warn: #ffb020;               /* amber */
      --danger: #ff4d6d;             /* pink/red */
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    }

    :root[data-theme="light"] {
      /* Light Mode - Based on HSL = 245-4-97 to 245-55-50 */
      --bg: hsl(245, 4%, 97%);        /* White BG - HSL = 245-4-97 */
      --bg2: hsl(245, 7%, 95%);       /* Lighter BG - HSL = 245-7-95 */
      --glass: rgba(0,0,0,0.02);
      --card: rgba(255,255,255,0.80);
      --stroke: hsl(245, 10%, 90%);   /* HSL = 245-10-90 */
      --text: hsl(245, 55%, 7%);      /* Strongest Text - HSL = 245-55-7 (inverted) */
      --text-strong: hsl(245, 45%, 14%); /* Strong text */
      --text-medium: hsl(245, 35%, 21%); /* Medium Text - HSL = 245-35-21 */
      --muted: hsl(245, 10%, 49%);    /* Subtle Text/Border - HSL = 245-10-49 */
      --subtle-bg: hsl(245, 10%, 90%); /* Subtle BG - HSL = 245-10-90 */
      --brand: hsl(245, 55%, 50%);    /* Accent - HSL = 245-55-50 */
      --brand-alt: hsl(245, 45%, 40%); /* Accent Alt - HSL = 245-45-40 */
      --accent: #0052cc;
      --ok: #21d17c;
      --warn: #d97706;
      --danger: #dc2626;
      --shadow: 0 4px 12px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.5);
    }

    /* ------- Background ------- */
    .bg {
      position: fixed; inset: 0; z-index: -1;
      background:
        radial-gradient(1200px 600px at 20% -10%, hsla(245, 55%, 50%, 0.2), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, hsla(245, 45%, 40%, 0.15), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      filter: saturate(1.1);
      transition: background 0.3s ease;
      pointer-events: none;
    }

    :root[data-theme="light"] .bg {
      background:
        radial-gradient(1200px 600px at 20% -10%, hsla(245, 55%, 70%, 0.15), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, hsla(245, 45%, 60%, 0.1), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
    }

    /* ------- Layout ------- */
    body { 
      color: var(--text); 
      transition: background-color 0.3s ease, color 0.3s ease; 
      background: var(--bg);
      position: relative;
      min-height: 100vh;
    }
    
    header {
      position: sticky; top: 0; z-index: 100; backdrop-filter: saturate(1.4) blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,0)) ;
      border-bottom: 1px solid var(--stroke);
    }
    
    :root[data-theme="light"] header {
      background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,0));
    }
    .wrap { display: grid; grid-template-columns: 300px 1fr; gap: 24px; max-width: 1280px; margin: 0 auto; padding: 24px; position: relative; z-index: 1; }
    @media (max-width: 980px) { .wrap { grid-template-columns: 1fr; padding: 16px; } }

    .brandbar { display:flex; align-items:center; gap:16px; padding: 16px 20px; flex-wrap: wrap; }
    .logo {
      width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, var(--brand), var(--accent));
      box-shadow: var(--shadow);
    }
    .title { font-size: 20px; font-weight: 700; color: var(--text); letter-spacing: -0.01em; line-height: 1.25; margin-bottom: 2px; }
    .muted { color: var(--muted); font-size: 16px; font-weight: 400; line-height: 1.5; }
    
    @media (max-width: 640px) {
      .brandbar { gap: 12px; padding: 12px 16px; }
      .logo { width: 36px; height: 36px; }
      .title { font-size: 18px; }
      .muted { font-size: 14px; }
    }

    /* Theme Toggle */
    .theme-toggle {
      width: 50px; height: 26px; border-radius: 999px; border: 1px solid var(--stroke);
      background: var(--subtle-bg); cursor: pointer; position: relative; transition: all 0.3s ease;
    }
    .theme-toggle::after {
      content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px;
      border-radius: 50%; background: var(--brand); transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    :root[data-theme="light"] .theme-toggle::after {
      left: calc(100% - 22px);
    }
    
    .header-controls {
      margin-left: auto; display: flex; gap: 8px; align-items: center;
    }
    
    @media (max-width: 640px) {
      .header-controls {
        width: 100%; margin-left: 0; justify-content: flex-end; gap: 6px;
      }
    }

    /* ------- Sidebar ------- */
    nav.sidebar {
      position: sticky; top: 68px; align-self: start; border-radius: var(--radius);
      background: var(--glass); border: 1px solid var(--stroke); backdrop-filter: blur(18px) saturate(1.4);
      box-shadow: var(--shadow);
      padding: 18px; max-height: calc(100dvh - 88px); overflow: auto;
      z-index: 10;
    }
    .progress {
      height: 8px; border-radius: 999px; background: var(--subtle-bg); overflow:hidden; margin: 12px 0 16px;
    }
    .progress > i { display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--brand), var(--brand-alt)); transition: width .3s ease; }
    .toc { list-style:none; padding:0; margin:0; display:grid; gap:4px; }
    .toc li { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .toc a { display:flex; gap:10px; align-items:center; padding:12px 14px; border-radius:12px; text-decoration:none; color:var(--text);
             background: transparent; border:1px solid transparent; transition: .2s ease; flex:1; font-size: 16px; font-weight: 400; line-height: 1.5; }
    .toc a:hover { border-color: var(--stroke); background: var(--card); }
    .toc .state { font-size: 13px; font-weight: 400; color: var(--muted); }
    .toc .done { color: var(--ok); }

    .search { display:flex; gap:8px; margin: 8px 0 16px; }
    .input {
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--stroke); background: var(--card);
      color: var(--text); outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
      font-size: 16px; font-weight: 400; line-height: 1.5;
    }

    /* ------- Main ------- */
    main { display:grid; gap: 24px; position: relative; z-index: 1; }
    .card {
      background: var(--glass); border: 1px solid var(--stroke); border-radius: var(--radius);
      backdrop-filter: blur(18px) saturate(1.4); box-shadow: var(--shadow); padding: 24px;
      position: relative; z-index: 1;
    }
    .card h2 { margin:0 0 12px; font-size: 31px; font-weight: 700; letter-spacing: -0.01em; line-height: 1.2; color: var(--text); }
    .card h3 { margin:24px 0 12px; font-size: 20px; font-weight: 700; letter-spacing: -0.01em; line-height: 1.25; color: var(--text-medium); }
    .card h3:first-of-type { margin-top: 0; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--stroke); background: var(--subtle-bg); font-size:13px; font-weight: 400; line-height: 1.5; color: var(--text-medium); }
    .controls { display:flex; gap:10px; flex-wrap:wrap; margin-top: 16px; }
    button, .btn {
      appearance:none; border:1px solid var(--stroke); background: var(--subtle-bg);
      color: var(--text); border-radius: 12px; padding:12px 20px; font-weight:600; font-size: 16px; 
      line-height: 1.5; cursor:pointer; box-shadow: var(--shadow); transition: all 0.2s ease;
    }
    button:hover { filter: brightness(1.1); }
    .btn-primary { border-color: transparent; background: linear-gradient(135deg, var(--brand), var(--brand-alt)); color: #ffffff; font-weight: 600; }
    
    @media (max-width: 640px) {
      button, .btn { padding: 10px 16px; font-size: 14px; }
    }

    ul.clean { padding-left: 1.5rem; margin: 16px 0; font-size: 18px; font-weight: 400; line-height: 1.7; }
    ul.clean li { margin: 10px 0; padding-left: 4px; }
    .grid-2 { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 760px) { .grid-2 { grid-template-columns: 1fr; } }

    .ghost { opacity:.75 }
    .small { font-size: 13px; font-weight: 400; line-height: 1.5; }

    /* Card content paragraphs */
    .card p { font-size: 18px; font-weight: 400; line-height: 1.7; margin: 12px 0; }
    .card strong { font-weight: 700; }
    .card em { font-style: italic; font-weight: 400; }
    
    /* Phrase highlighting */
    .phrase-item {
      transition: all 0.3s ease;
      padding: 12px 16px;
      padding-right: 80px;
      margin: 8px 0;
      border-radius: 10px;
      position: relative;
      background: transparent;
      border: 1px solid transparent;
    }
    .phrase-item:hover {
      border-color: var(--stroke);
      background: var(--card);
    }
    .phrase-item.reading {
      background: linear-gradient(135deg, var(--brand), var(--brand-alt));
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      border-color: transparent;
    }
    .phrase-item.reading strong,
    .phrase-item.reading em {
      color: #ffffff;
    }
    .phrase-item .phrase-text {
      display: block;
      padding-right: 8px;
    }
    .phrase-item .phrase-control-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--subtle-bg);
      color: var(--text);
      border: 1px solid var(--stroke);
      border-radius: 8px;
      padding: 6px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      z-index: 10;
      white-space: nowrap;
    }
    .phrase-item .phrase-control-btn:hover {
      transform: translateY(-50%) scale(1.05);
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .phrase-item.reading .phrase-control-btn {
      background: rgba(255, 255, 255, 0.95);
      color: var(--brand);
      border-color: transparent;
    }
    .phrase-item.reading .phrase-control-btn:hover {
      background: #ffffff;
    }
    
    @media (max-width: 640px) {
      .phrase-item {
        padding: 10px 12px;
        padding-right: 70px;
        font-size: 16px;
      }
      .phrase-item .phrase-control-btn {
        padding: 5px 10px;
        font-size: 12px;
        right: 8px;
      }
    }

    /* Print friendly */
    @media print {
      nav.sidebar { display:none; }
      header { position: static; background: transparent; border: 0; }
      body { background: white; color: black; }
      .bg { display:none; }
      .wrap { grid-template-columns: 1fr; padding: 0; }
      .card { box-shadow: none; backdrop-filter: none; border: 1px solid #ddd; }
      .btn, button { display:none; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <header role="banner">
    <div class="brandbar wrap" style="padding-top: 10px; padding-bottom: 10px;">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">Fluency Sprint 30</div>
        <div class="muted">WordPress developer • tutorials • marketing • podcast</div>
      </div>
      <div class="header-controls">
        <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark/light mode"></button>
        <button id="toggleNav" class="btn" aria-expanded="false" aria-controls="sidebar">Menu</button>
        <button id="printBtn" class="btn">Print Chapter</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar" aria-label="Chapters">
      <div class="pill" style="justify-content:space-between; width:100%;">
        <span>Progress</span>
        <span class="small" id="progressLabel">0%</span>
      </div>
      <div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
      <div class="search" role="search">
        <input id="search" class="input" placeholder="Search chapters… (vocab, phrases)"/>
      </div>
      <ul id="toc" class="toc" role="list"></ul>
      <div class="small muted" style="margin-top:10px;">Tip: Use J / K to switch chapters. Press D to toggle done.</div>
    </nav>

    <!-- Main -->
    <main id="main" role="main" aria-live="polite"></main>
  </div>

  <script>
    // ---------- Data Pools (compact) ----------
    const twisters = [
      "Red lorry, yellow lorry.",
      "A proper copper coffee pot.",
      "Unique New York.",
      "We surely shall see the sun shine soon.",
      "Crisp crusts crackle and crunch.",
      "Peter Piper picked a peck of pickled peppers.",
      "She sells seashells by the seashore.",
      "Toy boat, toy boat, toy boat.",
      "Black bug bit a big black bear.",
      "Six sleek swans swam swiftly southwards.",
      "The sixth sick sheik’s sixth sheep’s sick.",
      "Lesser leather never weathered wetter weather better.",
      "Green glass globes glow greenly.",
      "Thirty three thieves thought they thrilled the throne on Thursday.",
      "This feather is thicker than that feather.",
      "Five very vivid velvet vases vibrate.",
      "Four fine fresh fish for you.",
      "I kept a crisp compact script.",
      "Truly rural railway.",
      "Rolling red lorries really roll.",
      "Six shy sheep shook softly.",
      "Quickly compare hooks and filters with a concrete case.",
      "Cache cleared, config checked, connection confirmed.",
      "Press the build button, push the branch, and roll back the bug.",
      "Toggle the theme, tweak the tokens, then test the template.",
      "Click the clean clone and commit the changes clearly."
    ];

    const devTopics = [
      "customizing a Kadence theme","building a child theme","configuring WooCommerce",
      "setting up LocalWP","migrating a site from localhost to Hostinger",
      "connecting a Namecheap domain to Cloudflare DNS","installing a free SSL certificate",
      "tuning LiteSpeed Cache","optimizing Core Web Vitals","creating a staging site",
      "hardening WordPress security","setting up SMTP with WP Mail SMTP",
      "creating a clean permalink structure","adding WebP image optimization",
      "setting up automatic backups with UpdraftPlus","creating a custom header and footer",
      "fixing mixed content after SSL","deploying to Vercel via headless WordPress",
      "configuring Rank Math SEO","setting up a contact form with Fluent Forms"
    ];

    const steps = [
      "connect the domain","install WordPress","import the starter template",
      "create the child theme","customize the header","configure the theme options",
      "set up WooCommerce","add secure checkout","install SSL","force HTTPS",
      "optimize images","defer non critical JavaScript","set up caching",
      "prepare a staging site","test all forms","push to production",
      "monitor logs","create a backup","review Core Web Vitals","ship the changes"
    ];

    const vocabTech = [
      "repository","staging","rollback","deploy","schema","endpoint","payload","throttle","latency","bandwidth",
      "optimize","cache","invalidate","reflow","responsive","accessibility","semantic","minify","bundle","hydrate",
      "webhook","runtime","versioning","naming","deprecate","backward compatible","idempotent","isomorphic","scaffold","middleware",
      "pipeline","orchestration","container","monitoring","observability","telemetry","throughput","concurrency","memoization","debounce",
      "throttling","snapshot","checksum","signature","sandbox","permissions","namespace","token","secret","rate limit"
    ];
    const vocabWP = [
      "permalink","slug","child theme","template","hook","filter","shortcode","customizer","block editor","taxonomy",
      "custom post type","widget","enqueue","nonce","multisite","htaccess","cron","transient","query loop","action",
      "page builder","theme.json","functions.php","wp-config","media library","favicon","sitemap","breadcrumb","robots.txt","CDN",
      "lazy loading","critical CSS","CLS","LCP","TTFB","FCP","webp","sitemap index","redirect","canonical",
      "breadcrumbs","sticky header","off canvas","mega menu","hero section","CTA","opt in","lightbox","preload","prefetch"
    ];
    const vocabMarketing = [
      "value proposition","unique mechanism","lead magnet","funnel","tripwire","retargeting","remarketing","segmentation","positioning","differentiation",
      "lifetime value","acquisition","activation","retention","referral","conversion","attribution","persona","awareness","consideration",
      "copywriting","hook","cold open","call to action","social proof","testimonials","case study","cohort","benchmark","uplift",
      "split test","confidence interval","statistically significant","organic","paid","reach","impressions","click through rate","watch time","retention"
    ];
    const vocabSpeaking = [
      "coherent","concise","articulate","intonation","stress pattern","rhythm","cadence","enunciate","pause","hesitation",
      "paraphrase","rephrase","clarify","summarize","elaborate","contrast","emphasize","concede","counterpoint","segue",
      "rhetoric","analogy","assertion","premise","evidence","implication","nuance","hedge","stance","takeaway"
    ];

    const shadowing = {
      1:"Choose a clear American tech explainer, 60 to 90 seconds, and shadow it with chorus then echo.",
      2:"Pick a product demo by a US creator and focus on linking and reductions while shadowing.",
      3:"Shadow a Q and A clip and copy the melody of short answers and follow ups.",
      4:"Shadow a polished tutorial intro and copy the hook, the pace, and the micro pauses."
    }

    const drills = [
      "Record a 90 second one take explaining what you did today.",
      "Do the 3 2 1 compression on the same topic and keep it coherent.",
      "Answer three why questions about today’s task using the PREP structure.",
      "Teach the concept to a beginner in 60 seconds and then to a senior in 60 seconds.",
      "Record a cold open with hook, what, and why in 20 seconds.",
      "Deliver a five step explainer with a recap and a call to action.",
      "Run a Q and A hot seat with five quick prompts, 30 to 45 seconds each."
    ];

    const antiFiller = [
      "Land a sentence, pause silently for half a second, then start the next idea.",
      "Replace um and uh with a short breath and a reset phrase such as Right or Now.",
      "Keep sentences short and avoid stacking three prepositional phrases.",
      "Use a hand cue to pause whenever you feel a filler coming.",
      "Preload the first sentence before you hit record.",
      "Drop your speed by ten percent and keep articulation crisp.",
      "Chunk ideas into four to seven word thought groups."
    ];

    const phraseModes = ["hook","plan","transition","clarify","teach","debug","perf","cta","wrap","next"];

    // ---------- Helpers ----------
    function cyclePick(arr, idx) { return arr[idx % arr.length]; }
    function weekFromDay(day){ return Math.min(4, Math.floor((day-1)/7)+1); }

    function defFor(term){
      const map = {
        "repository":"code storage with history","staging":"safe testing environment","rollback":"revert to a previous version",
        "deploy":"publish a build to live","schema":"structured data blueprint","endpoint":"URL that accepts or returns data",
        "payload":"data sent in a request","latency":"delay before a transfer begins","bandwidth":"maximum data transfer rate",
        "optimize":"improve speed or efficiency","cache":"stored data for faster access","invalidate":"clear outdated cached data",
        "responsive":"adapts to different screens","accessibility":"usable by all people","semantic":"meaningful markup for clarity",
        "minify":"remove unnecessary characters","bundle":"combine files for delivery","hydrate":"attach interactivity to markup",
        "webhook":"server to server callback","runtime":"environment where code executes","permalink":"permanent page URL",
        "slug":"URL friendly name","child theme":"inheriting theme with overrides","hook":"trigger point for custom code",
        "filter":"function that modifies data","shortcode":"macro that renders content","taxonomy":"way to group content",
        "nonce":"security token to validate actions","transient":"temporary cached value","lead magnet":"free resource to capture emails",
        "funnel":"guided steps toward a goal","retargeting":"ads shown to past visitors","positioning":"how the offer is perceived",
        "lifetime value":"revenue over a customer life","activation":"first successful value moment","retention":"customers who keep using",
        "conversion":"desired action taken","coherent":"logically connected and consistent","concise":"clear and brief",
        "articulate":"express ideas clearly","intonation":"rise and fall of pitch","segue":"smooth transition between topics",
        "takeaway":"key point to remember"
      };
      return map[term] || "brief, practical definition";
    }

    function vocabExample(term){
      return `In this tutorial I use the term "${term}" and show how it fits into a real WordPress project.`;
    }

    function phraseLine(dev, step, mode){
      switch(mode){
        case "hook": return `Quick heads up, today I am ${dev} and I will ${step} so you can follow along with confidence.`;
        case "plan": return `The plan for today is simple, we will ${step} and then apply it to ${dev}.`;
        case "transition": return `With that in mind, let us ${step} to keep ${dev} on track.`;
        case "clarify": return `Just to be clear, you should ${step} before you start ${dev} on a live site.`;
        case "teach": return `Here is the intuition, when you ${step} the core of ${dev} becomes easier to maintain.`;
        case "debug": return `If you hit an error, ${step} again and compare logs so ${dev} keeps working.`;
        case "perf": return `From a performance point of view, we will ${step} and measure the impact on ${dev}.`;
        case "cta": return `My recommendation is to ${step} right now and then continue ${dev} with me.`;
        case "wrap": return `To recap, we managed to ${step} and the main ${dev} task is complete.`;
        default: return `Next up, we will ${step} and then continue ${dev} without rushing.`;
      }
    }

    // Build 30 chapters deterministically
    const vocabPool = [...new Set([...vocabTech, ...vocabWP, ...vocabMarketing, ...vocabSpeaking])];

    function buildDay(day){
      const titleBank = [
        "Reset and Clarity","Chunking and Breath","Linking and Reductions","Word Stress and Rhythm","Final Consonants and R",
        "Compression Drill Day","From Script to Bullet Points","Cold Open Practice","Q and A Melody","Clarity Under Speed",
        "Camera Comfort","Developer Collocations","Marketing Collocations","Podcast Host Energy","Repair and Paraphrase",
        "Contrast and Emphasis","American Flap T","Filler Free Flow","Story Braid Practice","Explain to a Client",
        "Micro Pauses on Camera","One Take Tutorials","Metrics Mindset","Retain and Recall","Live Q and A Prep",
        "Hook to Recap Loop","Multi Topic Switching","Exam Polish Day","Mini Tutorial Day","Final Showcase"
      ];
      const title = titleBank[day-1];
      const week = weekFromDay(day);

      // Twisters: pick 3 from rotating list
      const t = [ cyclePick(twisters, day-1), cyclePick(twisters, day+6), cyclePick(twisters, day+13) ];

      // Vocab: 20 rolling unique-ish picks
      const vocab = Array.from({length:20}, (_,i) => cyclePick(vocabPool, (day-1)*23 + i));

      // Phrases: 20 camera-ready lines
      const phrases = Array.from({length:20}, (_,i) => {
        const dev = cyclePick(devTopics, (day-1)+i);
        const step = cyclePick(steps, (day-1)*2 + i);
        const mode = cyclePick(phraseModes, i+day);
        return phraseLine(dev, step, mode);
      });

      const schedule = [
        "Warm up for five minutes with lip trills, hum, and slow vowels.",
        "Tongue twisters for five minutes at 80, 100, and 120 bpm.",
        "Shadowing for ten minutes using the weekly focus.",
        "Vocabulary for eight to ten minutes; read, say, and use each item.",
        "Phrase pack for eight to ten minutes, then deliver the production drill.",
        "Review and log metrics for two minutes."
      ];

      return {
        day, title, week,
        twisters: t,
        vocabulary: vocab.map(v => ({ term: v, def: defFor(v), ex: vocabExample(v) })),
        phrases,
        shadow: shadowing[week],
        drill: cyclePick(drills, day-1),
        anti: cyclePick(antiFiller, day-1),
        schedule
      };
    }

    const DAYS = Array.from({length:30}, (_,i)=>buildDay(i+1));

    // ---------- State & UI ----------
    const elTOC = document.getElementById('toc');
    const elMain = document.getElementById('main');
    const elSearch = document.getElementById('search');
    const elPB = document.getElementById('progressBar');
    const elPL = document.getElementById('progressLabel');

    const state = {
      current: 1,
      done: new Set(JSON.parse(localStorage.getItem('fs30_done')||'[]')),
      isReading: false,
      currentPhraseIndex: -1,
      currentUtterance: null,
    };

    function saveDone(){ localStorage.setItem('fs30_done', JSON.stringify([...state.done])); }

    // Theme Management
    function initTheme(){
      const saved = localStorage.getItem('fs30_theme');
      const theme = saved || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    }

    function toggleTheme(){
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('fs30_theme', next);
    }

    // Initialize theme on load
    initTheme();

    // Global toggle phrase reading function
    window.togglePhraseReading = function(index, btnElement) {
      if(!('speechSynthesis' in window)) return toast('Speech not supported');
      
      const synth = window.speechSynthesis;
      const phraseItem = document.querySelector(`[data-phrase-index="${index}"]`);
      const currentDay = DAYS[state.current - 1];
      
      // If this phrase is already reading, stop it
      if(state.isReading && state.currentPhraseIndex === index) {
        synth.cancel();
        state.isReading = false;
        state.currentPhraseIndex = -1;
        state.currentUtterance = null;
        
        phraseItem.classList.remove('reading');
        btnElement.textContent = 'Read';
        return;
      }
      
      // If another phrase is reading, stop it first
      if(state.isReading) {
        synth.cancel();
        const prevPhrase = document.querySelector(`[data-phrase-index="${state.currentPhraseIndex}"]`);
        const prevBtn = document.querySelector(`[data-phrase-btn="${state.currentPhraseIndex}"]`);
        if(prevPhrase) prevPhrase.classList.remove('reading');
        if(prevBtn) prevBtn.textContent = 'Read';
      }
      
      // Start reading this phrase
      state.isReading = true;
      state.currentPhraseIndex = index;
      
      phraseItem.classList.add('reading');
      btnElement.textContent = 'Stop';
      
      // Scroll to phrase
      phraseItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      const u = new SpeechSynthesisUtterance(currentDay.phrases[index]);
      u.rate = 1.02;
      u.pitch = 1.0;
      u.lang = 'en-US';
      state.currentUtterance = u;
      
      u.onend = () => {
        state.isReading = false;
        state.currentPhraseIndex = -1;
        state.currentUtterance = null;
        phraseItem.classList.remove('reading');
        btnElement.textContent = 'Read';
      };
      
      u.onerror = () => {
        state.isReading = false;
        state.currentPhraseIndex = -1;
        state.currentUtterance = null;
        phraseItem.classList.remove('reading');
        btnElement.textContent = 'Read';
      };
      
      synth.speak(u);
    };

    // Global stop reading function (for compatibility)
    window.stopReading = function() {
      if('speechSynthesis' in window){
        window.speechSynthesis.cancel();
        
        if(state.currentPhraseIndex >= 0) {
          const phraseItem = document.querySelector(`[data-phrase-index="${state.currentPhraseIndex}"]`);
          const btn = document.querySelector(`[data-phrase-btn="${state.currentPhraseIndex}"]`);
          if(phraseItem) phraseItem.classList.remove('reading');
          if(btn) btn.textContent = 'Read';
        }
        
        state.isReading = false;
        state.currentPhraseIndex = -1;
        state.currentUtterance = null;
        
        // Update main button if it exists
        const btn = document.getElementById('ttsPhrases');
        if(btn){
          btn.textContent = 'Read Phrases';
          btn.classList.remove('btn-primary');
          btn.classList.add('btn');
        }
        
        // Remove all highlights
        document.querySelectorAll('.phrase-item.reading').forEach(el => {
          el.classList.remove('reading');
        });
      }
    };

    function updateProgress(){
      const pct = Math.round((state.done.size/30)*100);
      elPB.style.width = pct + '%';
      elPL.textContent = pct + '%';
    }

    function renderTOC(filter=''){
      elTOC.innerHTML = '';
      DAYS.forEach(d => {
        const text = `Chapter ${d.day} — ${d.title}`.toLowerCase();
        const hay = [text, ...d.twisters, ...d.phrases, ...d.vocabulary.map(v=>v.term)].join(' ').toLowerCase();
        if(filter && !hay.includes(filter.toLowerCase())) return;
        const li = document.createElement('li');
        const a = document.createElement('a'); a.href = `#day-${d.day}`; a.textContent = `Chapter ${d.day}: ${d.title}`;
        a.addEventListener('click', (e)=>{ e.preventDefault(); openDay(d.day); });
        const span = document.createElement('span'); span.className = 'state ' + (state.done.has(d.day) ? 'done' : '');
        span.textContent = state.done.has(d.day) ? 'Done' : 'Not yet';
        li.appendChild(a); li.appendChild(span); elTOC.appendChild(li);
      });
    }

    function section(title, html){
      return `<section class="card"><h2>${title}</h2>${html}</section>`;
    }

    function list(items){ return `<ul class="clean">${items.map(i=>`<li>${i}</li>`).join('')}</ul>`; }
    
    function phraseList(items){ 
      return `<ul class="clean">${items.map((phrase, idx) => 
        `<li class="phrase-item" data-phrase-index="${idx}">
          <span class="phrase-text">${phrase}</span>
          <button class="phrase-control-btn" onclick="togglePhraseReading(${idx}, this)" data-phrase-btn="${idx}">Read</button>
        </li>`
      ).join('')}</ul>`;
    }

    function renderDay(d){
      const top = `
        <section id="day-${d.day}" class="card">
          <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
            <div>
              <h2 style="margin:0;">Chapter ${d.day}: ${d.title}</h2>
              <div class="muted small">Weekly shadowing theme: ${d.shadow}</div>
            </div>
            <div class="controls">
              <button class="btn-primary" id="markDone">${state.done.has(d.day) ? 'Mark as Not Done' : 'Mark as Done'}</button>
              <button class="btn" id="copyPhrases">Copy Phrases</button>
              <button class="btn" id="ttsPhrases">Read Phrases</button>
            </div>
          </div>
        </section>`;

      const sched = section('Daily schedule', list(d.schedule));
      const tw = section('Tongue twisters (clarity, speed, confidence)', list(d.twisters));
      const voc = section('Vocabulary (20) — definition and an example sentence', list(d.vocabulary.map(v=>`<strong>${v.term}</strong> — ${v.def}. <em>${v.ex}</em>`)));
      const phr = section('Phrase pack (20) — camera ready lines for today', phraseList(d.phrases));
      const bottom = `
        <div class="grid-2">
          ${section('Production drill', `<p>${d.drill}</p>`)}
          ${section('Anti filler focus', `<p>${d.anti}</p>`)}
        </div>
        ${section('Metrics to track', list(['Words per minute','Fillers per minute','One fix for tomorrow']))}
      `;

      elMain.innerHTML = top + sched + tw + voc + phr + bottom;

      // Wire buttons
      document.getElementById('markDone').onclick = ()=>{
        if(state.done.has(d.day)) state.done.delete(d.day); else state.done.add(d.day);
        saveDone(); updateProgress(); renderTOC(elSearch.value.trim()); openDay(d.day);
      };

      document.getElementById('copyPhrases').onclick = ()=>{
        navigator.clipboard.writeText(d.phrases.join('\n')).then(()=>{
          toast('Phrases copied');
        });
      };

      document.getElementById('ttsPhrases').onclick = ()=>{
        if(!('speechSynthesis' in window)) return toast('Speech not supported');
        const synth = window.speechSynthesis;
        const btn = document.getElementById('ttsPhrases');
        
        if(state.isReading){
          // Stop reading
          stopReading();
        } else {
          // Start reading all phrases sequentially
          synth.cancel();
          state.isReading = true;
          state.currentPhraseIndex = 0;
          
          btn.textContent = 'Stop Reading';
          btn.classList.remove('btn');
          btn.classList.add('btn-primary');
          
          // Function to read one phrase at a time
          const readPhrase = (index) => {
            if (index >= d.phrases.length || !state.isReading) {
              // Done reading all phrases
              state.isReading = false;
              state.currentPhraseIndex = -1;
              state.currentUtterance = null;
              btn.textContent = 'Read Phrases';
              btn.classList.remove('btn-primary');
              btn.classList.add('btn');
              
              // Clean up any highlights
              document.querySelectorAll('.phrase-item.reading').forEach(el => {
                el.classList.remove('reading');
              });
              document.querySelectorAll('.phrase-control-btn').forEach(b => {
                b.textContent = 'Read';
              });
              return;
            }
            
            // Remove previous highlight
            document.querySelectorAll('.phrase-item.reading').forEach(el => {
              el.classList.remove('reading');
            });
            document.querySelectorAll('.phrase-control-btn').forEach(b => {
              b.textContent = 'Read';
            });
            
            // Highlight current phrase
            const currentPhrase = document.querySelector(`[data-phrase-index="${index}"]`);
            const currentBtn = document.querySelector(`[data-phrase-btn="${index}"]`);
            if (currentPhrase) {
              currentPhrase.classList.add('reading');
              if(currentBtn) currentBtn.textContent = 'Stop';
              // Scroll to the phrase with smooth behavior
              currentPhrase.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            const u = new SpeechSynthesisUtterance(d.phrases[index]);
            u.rate = 1.02; u.pitch = 1.0; u.lang = 'en-US';
            state.currentUtterance = u;
            
            u.onend = () => {
              if (state.isReading) {
                state.currentPhraseIndex++;
                setTimeout(() => readPhrase(state.currentPhraseIndex), 300);
              }
            };
            
            u.onerror = () => {
              state.isReading = false;
              state.currentPhraseIndex = -1;
              state.currentUtterance = null;
              btn.textContent = 'Read Phrases';
              btn.classList.remove('btn-primary');
              btn.classList.add('btn');
              document.querySelectorAll('.phrase-item.reading').forEach(el => {
                el.classList.remove('reading');
              });
              document.querySelectorAll('.phrase-control-btn').forEach(b => {
                b.textContent = 'Read';
              });
            };
            
            synth.speak(u);
          };
          
          // Start reading from first phrase
          readPhrase(0);
        }
      };
    }

    function openDay(n){ 
      // Stop any ongoing speech when changing chapters
      if('speechSynthesis' in window && state.isReading){
        window.speechSynthesis.cancel();
        state.isReading = false;
        state.currentPhraseIndex = -1;
        state.currentUtterance = null;
      }
      state.current = n; 
      renderDay(DAYS[n-1]); 
      location.hash = `#day-${n}`; 
    }

    // Toast
    let toastEl; function toast(msg){
      if(!toastEl){ toastEl = document.createElement('div'); document.body.appendChild(toastEl); }
      toastEl.textContent = msg; toastEl.style.cssText = `position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:rgba(0,0,0,.7); color:white; padding:8px 12px; border-radius:12px; z-index:9999;`;
      setTimeout(()=>toastEl.remove(), 1400);
    }

    // Search
    elSearch.addEventListener('input', e => { renderTOC(e.target.value.trim()); });

    // Progress and TOC
    updateProgress(); renderTOC('');

    // Routing
    const hash = location.hash.match(/day-(\d+)/); const start = hash? parseInt(hash[1],10) : 1; openDay(start);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
      if(e.key==='j'){ if(state.current<30) openDay(state.current+1); }
      if(e.key==='k'){ if(state.current>1) openDay(state.current-1); }
      if(e.key==='d'){ document.getElementById('markDone')?.click(); }
    });

    // Mobile nav toggle
    const toggleBtn = document.getElementById('toggleNav');
    toggleBtn.addEventListener('click', ()=>{
      const sb = document.getElementById('sidebar');
      const open = sb.style.display !== 'none';
      if(open && window.innerWidth < 980){ sb.style.display = 'none'; toggleBtn.setAttribute('aria-expanded','false'); }
      else { sb.style.display = ''; toggleBtn.setAttribute('aria-expanded','true'); }
    });

    // Print
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
  </script>
</body>
</html>
